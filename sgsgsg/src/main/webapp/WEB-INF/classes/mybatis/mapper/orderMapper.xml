<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sgsg.dra.mapper.OrderMapper">

	<!-- 주문 추가 -->
	<insert id="insertOrder" parameterType="com.sgsg.dra.domain.Order">
		INSERT INTO PRODUCTORDER(ORDERNUM, USERID, ISSUE_ID, ORDERDATE, TOTALMONEY, USEDSAVED,
			DELIVERYCHARGE, PAYMENT, ORDERSTATE, ORDERSTATEDATE, CANCELAMOUNT, RECIPIENT,
			TEL, ZIP, ADDR1, ADDR2, DESTMEMO)
		VALUES (productOrder_seq.nextval, #{userId}, #{issue_id, jdbcType=VARCHAR}, sysdate,
			#{totalMoney},  #{usedSaved}, #{deliveryCharge}, #{payment}, #{orderState}, sysdate,
			#{CANCELAMOUNT, jdbcType=VARCHAR}, #{recipient}, #{tel}, #{zip}, #{addr1}, #{addr2},
			#{destMemo})
	</insert>
	
	
	<!-- 배송지 추가 -->
	<insert id="insertDest" parameterType="com.sgsg.dra.domain.Delivery">
		INSERT INTO MEMBER_DELIVERY(DESTINATIONNUM, RECIPIENTNAME, DEFAULTDEST, TEL, ZIP,
			REG_DATE, MOD_DATE, ADDR1, ADDR2, DESTMEMO, USERID)
		VALUES (member_delivery_seq.nextval, #{recipientName}, #{defaultDest},
			#{tel}, #{zip}, sysdate, sysdate, #{addr1}, #{addr2}, #{destMemo}, #{userId})
	</insert>
	
	<!-- 배송지 중 기본 배송지 검색 또는 insert시 같은 주소가 있는지 검색(할 예정) -->
	<select id="findByDest" parameterType="String" resultType="com.sgsg.dra.domain.Delivery">
		SELECT DESTINATIONNUM, RECIPIENTNAME, DEFAULTDEST, TEL, ZIP, REG_DATE, MOD_DATE,
			ADDR1, ADDR2, DESTMEMO, USERID
		FROM MEMBER_DELIVERY 
		WHERE USERID = #{userId} AND DEFAULTDEST = 1
	</select>
	
	<!-- 사용자의 모든 배송지 출력 -->
	<select id="selectAllDest" parameterType="String" resultType="com.sgsg.dra.domain.Delivery">
		SELECT DESTINATIONNUM, RECIPIENTNAME, DEFAULTDEST, TEL, ZIP, REG_DATE, MOD_DATE,
			ADDR1, ADDR2, DESTMEMO, USERID from MEMBER_DELIVERY WHERE USERID = #{userId}
	</select>
	
	<!-- 사용자가 기본 배송지를 재설정할 경우 다른 배송지를 기본 배송지가 아니게 -->
	<update id="updateDefaultDest" parameterType="String">
		UPDATE MEMBER_DELIVERY SET DEFAULTDEST=0 WHERE USERID = #{userId} AND DEFAULTDEST = 1
	</update>
	
	<!-- 배송지 삭제 -->
	<delete id="deleteDest" parameterType="Integer">
		DELETE FROM MEMBER_DELIVERY WHERE DESTINATIONNUM  = #{destinationNum}
	</delete>
	
	

</mapper>